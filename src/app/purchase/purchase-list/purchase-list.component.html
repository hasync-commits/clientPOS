<div class="purchase-wrapper">

  <mat-card>

    <mat-card-title>Purchase List</mat-card-title>

    <mat-card-content>

      <!-- FILTER SECTION -->
      <form [formGroup]="filterForm" class="filter-grid">

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option value="">All</mat-option>
            <mat-option value="draft">Draft</mat-option>
            <mat-option value="confirmed">Confirmed</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Supplier</mat-label>
          <mat-select formControlName="supplierId">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let s of suppliers" [value]="s._id">
              {{ s.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Period</mat-label>
          <mat-select formControlName="period">
            <mat-option value="">None</mat-option>
            <mat-option value="daily">Today</mat-option>
            <mat-option value="weekly">This Week</mat-option>
            <mat-option value="monthly">This Month</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>From</mat-label>
          <input matInput [matDatepicker]="fromPicker" formControlName="from">
          <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
          <mat-datepicker #fromPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>To</mat-label>
          <input matInput [matDatepicker]="toPicker" formControlName="to">
          <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
          <mat-datepicker #toPicker></mat-datepicker>
        </mat-form-field>

        <div class="filter-buttons">
          <button mat-raised-button color="primary" (click)="applyFilters()">
            Apply
          </button>
          <button mat-raised-button color="warn" (click)="resetFilters()">
            Reset
          </button>
        </div>

      </form>

      <!-- LOADING -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <!-- TABLE -->
      <table mat-table [dataSource]="dataSource" *ngIf="!isLoading">

        <ng-container matColumnDef="purchaseCode">
          <th mat-header-cell *matHeaderCellDef> Code </th>
          <td mat-cell *matCellDef="let element">
            {{ element.purchaseCode }}
          </td>
        </ng-container>

        <ng-container matColumnDef="supplier">
          <th mat-header-cell *matHeaderCellDef> Supplier </th>
          <td mat-cell *matCellDef="let element">
            {{ element.supplierId?.name || element.supplierId }}
          </td>
        </ng-container>

        <ng-container matColumnDef="invoiceNumber">
          <th mat-header-cell *matHeaderCellDef> Invoice </th>
          <td mat-cell *matCellDef="let element">
            {{ element.invoiceNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="purchaseDate">
          <th mat-header-cell *matHeaderCellDef> Date </th>
          <td mat-cell *matCellDef="let element">
            {{ element.purchaseDate | date:'mediumDate' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="grandTotal">
          <th mat-header-cell *matHeaderCellDef> Total </th>
          <td mat-cell *matCellDef="let element">
            {{ element.grandTotal | number:'1.2-2' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef> Status </th>
          <td mat-cell *matCellDef="let element">
            <span [class.confirmed]="element.status==='confirmed'"
                  [class.draft]="element.status==='draft'">
              {{ element.status }}
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

    </mat-card-content>

  </mat-card>

</div>